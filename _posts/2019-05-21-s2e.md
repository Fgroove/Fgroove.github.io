---
layout: post
title:  S2E
date:   2019-05-21 09:05:01 +0800
categories: 沙箱逃逸
tag: S2E

---
* content
{:toc}




## S2E Installatio

## Linux Setup

* Ubuntu 16.04 LTS

### FAQ

#### 1.`protobuf-to-dic`安装出现各种问题

```shell
$ python setup.py install
...
error: Could not find suitable distribution for Requirement.parse('pygments')
```

`pygments` error

```shell
sudo apt install python-setuptools
sudo easy_install pyparsing
```



#### 2.test

```shell
$ python setup.py test
...
error:cannot import name ENUM_P_TYPE
```

[stackoverflow](https://stackoverflow.com/questions/52145516/pwntools-python-not-importing),`ENUM_P_TYPE`更新为`ENUM_P_TYPE_BASE`

### 3.Using s2e-env

#### 创建环境

```shell
s2e init /home/user/s2e
```



## Setting up a Windows development environment

---

官方[docs]([http://s2e.systems/docs/WindowsEnvSetup.html](http://s2e.systems/docs/WindowsEnvSetup.html))

本教程介绍如何快速设置Windows开发环境，以在其中构建Windows应用程序和设备驱动程序。 有助于开发适用于Windows的S2E Guest工具（例如，s2e.sys来宾驱动程序）或只是想在S2E中构建和运行各种Windows应用程序。

```plain
!NOTE
本教程不是关于如何在Windows机器上编译和运行S2E本身。我们不支持在Windows主机上运行S2E，但我们得到报告称S2E在Windows 10 WSL环境或docker容器中构建和运行。
```

在本教程中，您将使用位于`~/s2e/env/source/s2e/build-scripts/windows`[目录](https://github.com/S2E/build-scripts/tree/master/windows)中的各种脚本。 此文件夹包含简化Windows开发VM设置的脚本。 大多数脚本假设您拥有Linux主机并且想要设置干净的Windows VM以进行开发（例如，构建S2E的Windows特定组件，例如s2e.sys Guest驱动程序）。

先决条件：

* 在Linux主机上有一个可用的S2E环境
* 有一个工作的虚拟机管理程序（VMware，Virtual Box等）
* 可以访问64位Windows 10 1803 ISO（例如通过MSDN）
* 有Internet连接（安装将下载几个GB）
* 有足够的磁盘空间和可用内存（VM需要至少60 GB的磁盘和4 GB的RAM）。

### 1. Provisioning a Windows development VM

首先，需要构建一个Windows VM。 在本节结束时，将拥有一个带有Visual Studio 2017社区版的Windows 10 VM，WDK和SSH服务器。 Visual Studio将与所有C/C++开发选项一起安装（支持XP，7,8.1,10）。 您将能够SSH到此VM，rsync文件，并进行远程构建。

* 安装Windows 10 VM。 为客人使用60GB磁盘和4GB RAM。 任何64位Windows 10版本都应该可以使用，但建议您使用最新版本（脚本已通过版本1803测试）。

  最好使用`s2e`作为admin用户的登录。 大多数脚本将`s2e`视为默认用户名，因此您不必在以后覆盖此用户名。 除此之外，vanilla installation(默认安装)也可以。

  当进入Windows桌面时，创建快照，以便以后出现问题时可以快速恢复。

* 提供Guest。 使用管理员权限打开PowerShell并运行`Setup-DevHost.ps1`脚本。 需要从guest虚拟机访问此脚本，例如，使用VirtualBox / VMware上的共享文件夹将主机目录映射到guest虚拟机。

  等到脚本终止。 它是完全自动化的，无需人工干预。

```plain
!Warning
不要在主机Windows环境中运行配置脚本。该脚本假定在VM中安装了全新的Windows，如果您已安装Visual Studio环境，则可能会损坏现有的Visual Studio环境。如果您仍希望在主机上运行该脚本（例如，您没有Visual Studio或想要设置SSH），请仔细检查其内容以确保它不会干扰。必要时删除有问题的部分。
```

```plain
该脚本需要Internet访问才能成功运行。 它主要使用Chocolatey包管理器来安装软件。
```

```plain
!Note
您可以在guest虚拟机中安装所需的任何其他软件包。 Chocolatey附带了大量支持的Windows应用程序。 只需将 choco install -y package_name 添加到PowerShell脚本即可。
```

* 检查安装是否正确。 打开Visual Studio并尝试在x86/x64 调试/发布组合中构建S2E guest虚拟机工具。 你不应该得到任何错误。

* 检查远程连接。 检查您是否可以通过SSH连接到VM。 您应该获得Windows命令提示符。

* 最后，别忘了创建快照。

### 2. Building Visual Studio projects remotely

在本节中，我们将介绍如何在上一节中构建的VM中构建Visual Studio项目。

*  将公共SSH密钥复制到Guest VM。 这很重要，因为远程构建脚本会要求您多次键入VM密码，这不方便。

### 3. Use case: building and running a Windows device driver



